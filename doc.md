# Трекер расходов

# Предисловие
Тема учёта расходов в реальности слишком неудобна для конечного пользователя, вероятно, только в исключительных случаях, когда юзер намеренно избегает банковских приложений, которые предоставляют достаточно детализированную статистику (иногда даже с анализом расходов и рекомендациями по "финансовому здоровью"); можно рассмотреть случай кросс-банковского анализа по большому количеству источников (многие пользуются более чем одним банком), но такая интеграция не представляется возможной, так как банки не предоставляют публичные api (получение доступа к api возможно только для юридическиз лиц; я проверил достпуную документацию у T-Bank, предполагаю, что в других банках такая же ситуация)
Даже если рассматривать ситуацию, где мы используем программу локально, для личного использования, то пытаться парсить какие-то данные кажется нецелесообразным

На основании приведённых выше аргументов на этапе MVP следует остановиться на ручном внесении данных в систему:
1) Внесении каждой отдельной взятой операции полностью ручным способом
2) Заказать выписку по счёту в банке; 
Мы получаем выписку в виде pdf, после чего мы можем программно перевести .pdf в .txt, например, через pdftotext и получим уже вполне читаемые данные для внесения в базу и, соответственно, более автоматизированный режим, требующий гораздо меньше действий от пользователя 
(При таком методе остаётся проблема с категоризацией платежей (по мере развития проекта можно прикрутить алгоритм, который будет сопоставлять наименование с категорией; возможно, есть способ получать MCC коды для транзакций от банка в выписке или иным образом, но я пока не понял, как это сделать), и важно корректно решать и учитывать проблему переводов между своими же счетами, чтобы избежать ситуации при которой какой-то счёт не будет учтён и реальность будет расходиться с загруженными данными) 

---

# Жизненный цикл продукта

Идея: свести расходы из многих источников в одно место для понятного отслеживания трат

Валидация: проверить, что людям достаточно ручного ввода (какие поля реально вводят; нужны ли счета/категории)

MVP-дизайн: минимальная доменная модель Transaction, базовые категории, простые правила валидации

Разработка MVP:
создание операции (ручной ввод),
получение/список операций,
базовая сводка за период (опционально)

Бета: улучшение UX ввода (предзаданные категории, дефолтные значения), обработка ошибок, логи/метрики

Релиз: документация

Поддержка и развитие: переводы между счетами, повторяющиеся операции, импорт выписок, расширенная аналитика

# Ключевые требования к системе
## Функциональные:
- Создать операцию: expense|income, сумма, валюта, дата/время, категория, описание (опционально), счёт (опционально)
- Получить операцию: по id.
- список операций за период с фильтрами (даты, категория, тип)

## Нефункциональные:
- Корректность: сумма >0, валюта валидна/фиксирована, предсказуемые правила времени
- Изоляция данных: модель должна предусматривать user_id
- Поддерживаемость: бизнес-правила в домене/сервисах, а не в роутерах.
- Observability: точки для логов на use-caseах

# Контексты в терминах DDD
Core Bounded Context: Учёт
- Всё, что связано с операциями и их правилами: Transaction, Money, тип операции, базовые инварианты

Supporting Bounded Context: Категории
- Справочник категорий и правила их использования

Supporting Bounded Context: Счета

Внешние контексты (External):
- Identity/Auth: источник user_id
- Bank Import/Statement Parsing: отдельный будущий контекст

---

# Архитектура

Микросервисы в данном случае не нужны, проект достаточно мал, для того чтобы скорость разработки и удобство монолита перевешивало


-----

# User Stories
US-1 (High): Создание операции
Как пользователь, я хочу добавить доход/расход вручную, чтобы вести учёт движения денег.
Acceptance Criteria (DoD для истории):

доступен endpoint создания операции;
обязательные поля валидируются;
сумма должна быть больше 0;
созданная операция доступна по id.


US-2 (High): Аналитика по категориям
Как пользователь, я хочу получить транзакции по выбранным категориям и сумму трат по ним, чтобы понимать, на что уходит бюджет.

Acceptance Criteria:
endpoint принимает список category_ids;
возвращает только транзакции пользователя;
возвращает total_expense и expense_by_category;
в агрегатах учитываются только expense.


US-3 (Medium): Аналитика за период
Как пользователь, я хочу получать транзакции за период и суммы по категориям, чтобы анализировать расходы за неделю/месяц.

Acceptance Criteria:
endpoint принимает start_at, end_at;
при start_at > end_at возвращается ошибка валидации;
возвращаются список транзакций + сумма трат + суммы по категориям.


# Backlog

PB-1: Уточнение API-контрактов и критериев приёмки
Оценка: 2 ч
Связанные истории: US-1, US-2, US-3
Результат: согласованные request/response модели, перечень ошибок.

PB-2: Реализация базовых операций
Оценка: 5 ч
Связанные истории: US-1
Результат: рабочие эндпоинты и сервисная логика.

PB-3: Реализация фильтра по категориям
Оценка: 5 ч
Связанные истории: US-2
Результат: endpoint by-categories, суммирование расходов

PB-4: Реализация аналитики по периоду
Оценка: 5 ч
Связанные истории: US-3
Результат: endpoint by-period

PB-5: Unit-тесты на сервисный слой
Оценка: 4 ч
Связанные истории: US-1, US-2, US-3
Результат: тесты по валидации и агрегациям.

PB-6: Observability и документация API
Оценка: 3 ч
Связанные истории: US-1, US-2, US-3
Результат: комментарии и точки для логов и метрик, README

PB-7: Bugfix
Оценка: 2 ч
Результат: устранение дефектов после прогона тестов и ручной проверки

Приоритизация
Must have: US-1, US-2
Should have: US-3
Could have (вне спринта): пагинация, фильтры по сумме, импорт выписок

Definition of Done
все endpoint из US-1..US-3 реализованы и вручную проверены;
unit-тесты зелёные;
ошибки и валидация возвращают предсказуемые HTTP-коды;
документация и примеры запросов обновлены.